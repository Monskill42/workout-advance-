<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gym Progress Tracker</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f1724" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg:#0f1724; --card:#0b1220; --muted:#94A3B8; --accent:#6ee7b7;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071024 0%, #0f1724 100%);color:#e6eef8;}
    header{padding:28px 24px;text-align:center;}
    header h1{margin:0;font-size:24px;}
    header p{margin:6px 0 0;color:var(--muted);}
    .container{display:grid;grid-template-columns:1fr 360px;gap:20px;padding:20px;}
    .days{display:flex;gap:10px;justify-content:center;margin-bottom:8px;}
    .day-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px 14px;border-radius:10px;color:var(--muted);cursor:pointer;transition:.2s;}
    .day-btn.active{background:linear-gradient(90deg,rgba(110,231,183,0.08),rgba(110,215,167,0.02));color:var(--accent);box-shadow:0 6px 18px rgba(110,231,183,0.06);}
    #workouts-area{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;}
    .workout-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:14px;padding:14px;box-shadow:0 4px 24px rgba(2,6,23,0.6);transition:.18s;}
    .workout-card:hover{transform:translateY(-6px);}
    .set-row{display:flex;gap:8px;align-items:center;margin:6px 0;}
    input[type=number],select{padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;}
    .btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;background:var(--accent);color:#00221a;font-weight:600;}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(110,231,183,0.12);}
    .sidebar{position:sticky;top:18px;max-height:90vh;overflow-y:auto;}
    .card{background:var(--card);padding:12px;border-radius:12px;margin-bottom:12px;}
    .log-item{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);margin-bottom:8px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);}
    .danger{background:#ff6b6b;color:#280000;}
    .small{font-size:13px;color:var(--muted);}
    footer{text-align:center;padding:16px;color:var(--muted);}
    @media(max-width:900px){.container{grid-template-columns:1fr;}.sidebar{position:relative;}}
  </style>
</head>
<body>
  <header>
    <h1>Gym Progress Tracker</h1>
    <p>Track your workouts, rest smart, and visualize your gains — offline capable!</p>
  </header>

  <main class="container">
    <section>
      <div class="days">
        <button class="day-btn active" data-day="day1">Day 1 — Back & Biceps</button>
        <button class="day-btn" data-day="day2">Day 2 — Chest & Triceps</button>
        <button class="day-btn" data-day="day3">Day 3 — Shoulders & Forearms</button>
      </div>
      <div id="workouts-area"></div>
    </section>

    <aside class="sidebar">
      <div class="card">
        <h3>Progress Chart</h3>
        <label for="chart-workout">Select workout:</label>
        <select id="chart-workout"></select>
        <canvas id="progressChart" height="200"></canvas>
      </div>

      <div class="card">
        <h3>Workout History</h3>
        <label for="day-filter">Filter by Day:</label>
        <select id="day-filter">
          <option value="day1">Back & Biceps</option>
          <option value="day2">Chest & Triceps</option>
          <option value="day3">Shoulders & Forearms</option>
        </select>
        <label for="date-filter" style="display:block;margin-top:6px;">Select Date:</label>
        <input type="date" id="date-filter" style="width:100%;margin-bottom:8px;">
        <div style="display:flex;gap:8px;">
          <button id="download-csv" class="btn">Download CSV</button>
        </div>
        <div id="history-list" style="margin-top:10px;"></div>
      </div>

      <div class="card">
        <h3>Logs</h3>
        <div id="logs-list"></div>
        <button id="clear-logs" class="danger">Clear All Logs</button>
      </div>
    </aside>
  </main>

  <footer>Made with ❤️ | Works offline</footer>

  <script>
    const days = {
      day1:{name:'Back & Biceps',workouts:[
        {name:'Warmup',sets:1,warmup:true},
        {name:'Lat pull down',sets:3},
        {name:'Cable rows',sets:3},
        {name:'Double rear delt',sets:3},
        {name:'Biceps curl incline',sets:3},
        {name:'Biceps curl long head',sets:3},
        {name:'Biceps curl seated',sets:3},
        {name:'Biceps curl supported',sets:3}
      ]},
      day2:{name:'Chest & Triceps',workouts:[
        {name:'Warmup',sets:1,warmup:true},
        {name:'Incline bench press',sets:3},
        {name:'Flat bench press',sets:3},
        {name:'Cable fly',sets:3},
        {name:'Scull crusher',sets:3},
        {name:'Rope extension',sets:3},
        {name:'Triceps extension',sets:3}
      ]},
      day3:{name:'Shoulders & Forearms',workouts:[
        {name:'Warmup',sets:1,warmup:true},
        {name:'Lateral raises',sets:3},
        {name:'Lateral front raises',sets:3},
        {name:'Double press',sets:3},
        {name:'Forarms',sets:3},
        {name:'Forearms back',sets:3},
        {name:'Forearms side',sets:3},
        {name:'Pushups',sets:3}
      ]}
    };

    const STORAGE_KEY='gymLogs_v3';
    function loadLogs(){return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')}
    function saveLogs(l){localStorage.setItem(STORAGE_KEY,JSON.stringify(l))}

    const workoutsArea=document.getElementById('workouts-area');
    function renderDay(key){
      workoutsArea.innerHTML='';
      days[key].workouts.forEach(w=>{
        const card=document.createElement('div');card.className='workout-card';
        card.innerHTML=`<h4>${w.name}${w.warmup?' • warmup':''}</h4>`;
        const sets=document.createElement('div');
        for(let i=0;i<w.sets;i++){
          const row=document.createElement('div');row.className='set-row';
          const label=document.createElement('div');label.className='small';label.textContent='Set '+(i+1);
          const weight=document.createElement('input');weight.type='number';weight.placeholder='kg';
          const reps=document.createElement('select');
          for(let r=1;r<=20;r++){const o=document.createElement('option');o.value=r;o.textContent=r;reps.appendChild(o);}
          const rest=document.createElement('button');rest.className='btn ghost';rest.textContent='Start Rest';rest.dataset.warmup=w.warmup?'1':'0';
          rest.onclick=()=>startRestTimer(rest);
          row.append(label,weight,reps,rest);sets.appendChild(row);
        }
        const date=document.createElement('input');date.type='date';date.value=new Date().toISOString().slice(0,10);
        const save=document.createElement('button');save.className='btn';save.textContent='Save Log';
        save.onclick=()=>saveWorkoutLog(key,w,card,date.value);
        const controls=document.createElement('div');controls.className='controls';controls.append(date,save);
        card.append(sets,controls);workoutsArea.appendChild(card);
      });
    }

    // === Timer with pause + loud tone ===
    let timerInterval=null;
    function startRestTimer(btn){
      let t=150;
      let paused=false;
      btn.disabled=true;
      const pauseBtn=document.createElement('button');
      pauseBtn.className='btn ghost';
      pauseBtn.textContent='Pause';
      btn.after(pauseBtn);
      const orig=btn.textContent;
      btn.textContent=formatTime(t);
      clearInterval(timerInterval);

      timerInterval=setInterval(()=>{
        if(!paused){t--;btn.textContent=formatTime(t);}
        if(t<=0){
          clearInterval(timerInterval);
          btn.disabled=false;
          pauseBtn.remove();
          btn.textContent=orig;
          playEndTone();
        }
      },1000);

      pauseBtn.onclick=()=>{
        paused=!paused;
        pauseBtn.textContent=paused?'Resume':'Pause';
      };
    }
    function formatTime(s){return `${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;}
    function playEndTone(){
      try{
        const ctx=new (AudioContext||webkitAudioContext)();
        const o=ctx.createOscillator();
        const g=ctx.createGain();
        o.type='square';
        o.frequency.value=880;
        o.connect(g);
        g.connect(ctx.destination);
        o.start();
        g.gain.setValueAtTime(0.8,ctx.currentTime);
        g.gain.linearRampToValueAtTime(0,ctx.currentTime+5);
        o.stop(ctx.currentTime+5);
      }catch(e){console.log(e);}
    }

    // === Logging and history ===
    function saveWorkoutLog(dayKey,w,card,date){
      const weights=[...card.querySelectorAll('input[type=number]')];
      const reps=[...card.querySelectorAll('select')];
      const sets=weights.map((el,i)=>({set:i+1,weight:+el.value||0,reps:+reps[i].value||0}));
      const volume=sets.reduce((s,x)=>s+x.weight*x.reps,0);
      const logs=loadLogs();
      logs.push({date,day:dayKey,workout:w.name,volume,sets});
      saveLogs(logs);
      renderLogs();refreshChartOptions();renderHistory();
    }

    function renderLogs(){
      const list=document.getElementById('logs-list');
      const logs=loadLogs().slice().reverse();
      if(!logs.length){list.innerHTML='<div class="small">No logs yet</div>';return;}
      list.innerHTML=logs.map(l=>{
        const setsHtml=l.sets.map(s=>`<div class="small">Set ${s.set}: ${s.weight} kg × ${s.reps} reps</div>`).join('');
        return `<div class='log-item'>
          <strong>${l.workout}</strong> — <span class='small'>${l.date}</span>
          <div class='small'>Total Volume: ${l.volume} kg</div>${setsHtml}
        </div>`;
      }).join('');
    }

    function renderHistory(){
      const filter=document.getElementById('day-filter').value;
      const dateFilter=document.getElementById('date-filter').value;
      const list=document.getElementById('history-list');
      const logs=loadLogs().filter(l=>l.day===filter && (!dateFilter || l.date===dateFilter));
      if(!logs.length){list.innerHTML='<div class="small">No history yet for this selection</div>';return;}
      const grouped={};
      logs.forEach(l=>{
        if(!grouped[l.workout]) grouped[l.workout]=[];
        grouped[l.workout].push(l);
      });
      list.innerHTML=Object.entries(grouped).map(([workout,entries])=>{
        const html=entries.map(e=>{
          const setsHtml=e.sets.map(s=>`<div class="small">Set ${s.set}: ${s.weight} kg × ${s.reps} reps</div>`).join('');
          return `<div class='log-item'><span class='small'>${e.date}</span>${setsHtml}</div>`;
        }).join('');
        return `<div class='log-item'><strong>${workout}</strong>${html}</div>`;
      }).join('');
    }

    function downloadCSV(){
      const logs=loadLogs();
      if(!logs.length){alert("No data to export");return;}
      let csv="Date,Day,Workout,Set,Weight (kg),Reps,Total Volume\n";
      logs.forEach(l=>{
        l.sets.forEach(s=>{
          csv+=`${l.date},${days[l.day].name},${l.workout},${s.set},${s.weight},${s.reps},${l.volume}\n`;
        });
      });
      const blob=new Blob([csv],{type:"text/csv"});
      const url=URL.createObjectURL(blob);
      const a=document.createElement("a");
      a.href=url;
      a.download="Workout_History.csv";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    let chart=null;
    function refreshChartOptions(){
      const sel=document.getElementById('chart-workout');
      const names=new Set(loadLogs().map(l=>l.workout));sel.innerHTML='';
      Array.from(names).forEach(n=>{const o=document.createElement('option');o.value=n;o.textContent=n;sel.appendChild(o);});
      if(sel.options.length) sel.value=sel.options[sel.options.length-1].value;
      renderChart();
    }
    function renderChart(){
      const sel=document.getElementById('chart-workout');
      const logs=loadLogs().filter(l=>l.workout===sel.value);
      const ctx=document.getElementById('progressChart').getContext('2d');
      if(chart) chart.destroy();
      chart=new Chart(ctx,{type:'line',data:{labels:logs.map(l=>l.date),datasets:[{label:'Total Volume (kg)',data:logs.map(l=>l.volume),fill:true,tension:0.3}]},options:{scales:{y:{beginAtZero:true}}}});
    }

    document.querySelectorAll('.day-btn').forEach(b=>b.onclick=()=>{document.querySelectorAll('.day-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');renderDay(b.dataset.day);});
    document.getElementById('clear-logs').onclick=()=>{if(confirm('Clear all logs?')){saveLogs([]);renderLogs();refreshChartOptions();renderHistory();}};
    document.getElementById('chart-workout').onchange=renderChart;
    document.getElementById('day-filter').onchange=renderHistory;
    document.getElementById('date-filter').onchange=renderHistory;
    document.getElementById('download-csv').onclick=downloadCSV;

    renderDay('day1');renderLogs();refreshChartOptions();renderHistory();

    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('sw.js').catch(console.error);
    }
  </script>
</body>
</html>
